<app-header-navbar></app-header-navbar>
<div class="container-fluid dashboard-container">
  <div class="row">
    <div class="col-12 col-lg-2">
      <app-side-navbar></app-side-navbar>
    </div>
    <div class="col-12 col-lg-10">
      <div class="row">
        <div class="col-12 main-container">
          <div class="row big-option-container">
            <div class="desktop-option">
              <div class="col-12">
                <div class="row">
                  <div class="col-3">
                    <button mat-button class="menu-button">
                      <span>Fees > Reminder</span>
                    </button>
                  </div>
                  <div class="col-9" style="text-align: right;">
                    <div class="row">
                      <div class="col-2 offset-10">
                        <button class="submit-button" mat-raised-button
                          (click)="addStudentModel()"><mat-icon>add</mat-icon>Create</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="mobile-option">
              <div class="col-12">
                <div class="row">
                  <div class="col-3">
                    <button mat-button class="menu-button">
                      <span>Fees > Reminder</span>
                    </button>
                  </div>
                  <div class="col-5 offset-4">
                    <button class="submit-button" mat-raised-button
                      (click)="addStudentModel()"><mat-icon>add</mat-icon>Create</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="main-container">
          <div class="col-12 col-lg-12 big-container">
            <div class="main-card">
              <div class="table-wrapper">
                <table class="table table-hover align-middle bg-white">
                  <thead class="bg-light">
                    <!-- <tr class="text-muted">
                      <th>S.No.</th>
                      <th>Fee Reminder</th>
                      <th>Student</th>
                      <th>Father Name</th>
                      <th>Mother Name</th>
                      <th>Class</th>
                      <th>Stream</th>
                      <th>Roll Number</th>
                      <th>Session</th>
                      <th>Admission By</th>
                      <th>Admission Letter</th>
                    </tr> -->
                  </thead>
                </table>
              </div>
              <div class="modal fade show" [class.show]="showModal">
                <div class="modal-dialog modal-dialog-scrollable" [class.modal-lg]="true">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">SEND FEE REMINDER</h5>
                      <mat-icon matRipple (click)="closeModal()">close</mat-icon>
                    </div>
                    <ng-container *ngIf="!filterStatus">
                      <form [formGroup]="studentFilterForm" (ngSubmit)="studentFilter()">
                        <div class="modal-body">
                          <div class="container">
                            <div class="row">
                              <div class="col-12 col-lg-6">
                                <mat-form-field appearance="outline">
                                  <mat-label>Class</mat-label>
                                  <mat-select matInput formControlName="class">
                                    <div *ngFor="let classInfo of classInfo">
                                      <mat-option value="{{classInfo.class}}"
                                        (click)="chooseClass(classInfo.class)">{{classInfo.class |
                                        classSuffix}}</mat-option>
                                    </div>
                                  </mat-select>
                                  <mat-error
                                    *ngIf="studentFilterForm.get('class')?.hasError('required') && studentFilterForm.get('class')?.touched">
                                    Class is required
                                  </mat-error>
                                  <mat-error
                                    *ngIf="studentFilterForm.get('class')?.hasError('pattern') && studentFilterForm.get('class')?.touched">
                                    Please enter a valid class (numeric characters only)
                                  </mat-error>
                                </mat-form-field>
                              </div>
                              <div class="col-12 col-lg-6">
                                <mat-form-field appearance="outline">
                                  <mat-label>Payment Below (%)</mat-label>
                                  <mat-select formControlName="minPercentage">
                                    <mat-option *ngFor="let percent of [0,10, 20, 30, 40, 50, 60, 70, 80, 90, 100]"
                                      [value]="percent">
                                      <span *ngIf="percent==0">No Filter</span>
                                      <span *ngIf="percent>0">Less Then {{ percent }}% Paid</span>
                                    </mat-option>
                                  </mat-select>
                                  <mat-error
                                    *ngIf="studentFilterForm.get('minPercentage')?.hasError('required') && studentFilterForm.get('minPercentage')?.touched">
                                    Payment below (%) is required
                                  </mat-error>
                                  <mat-error
                                    *ngIf="studentFilterForm.get('minPercentage')?.hasError('pattern') && studentFilterForm.get('minPercentage')?.touched">
                                    Please enter a valid in payment below (%) (numeric characters only)
                                  </mat-error>
                                </mat-form-field>
                              </div>

                              <div class="col-12 col-lg-6">
                                <mat-form-field appearance="outline">
                                  <mat-label>No Payment Since</mat-label>
                                  <mat-select formControlName="lastPaymentDays">
                                    <mat-option
                                      *ngFor="let day of [0,7, 15, 30, 45, 60, 90,120,150,180,210,240,270,300,330,365 ]"
                                      [value]="day">
                                      <span *ngIf="day<1 && day==0">No Filter</span>
                                      <span *ngIf="day<=60 && day!==0">Last: {{ day }}+ Days</span>
                                      <span *ngIf="day>60 && day!==365">Last: {{ day/30 }}+ Months</span>
                                      <span *ngIf="day==365">Last: 12+ Months</span>
                                    </mat-option>
                                  </mat-select>
                                  <mat-error
                                    *ngIf="studentFilterForm.get('lastPaymentDays')?.hasError('required') && studentFilterForm.get('lastPaymentDays')?.touched">
                                    No payment since is required
                                  </mat-error>
                                  <mat-error
                                    *ngIf="studentFilterForm.get('lastPaymentDays')?.hasError('pattern') && studentFilterForm.get('lastPaymentDays')?.touched">
                                    Please enter a valid no payment since (numeric characters only)
                                  </mat-error>
                                </mat-form-field>
                              </div>

                              <div class="col-12 col-lg-6">
                                <mat-form-field appearance="outline">
                                  <mat-label>Gap Since Last Reminder</mat-label>
                                  <mat-select formControlName="lastReminderDays">
                                    <mat-option *ngFor="let reminder of [0,7, 15, 30, 45, 60, 90]" [value]="reminder">
                                      <span *ngIf="reminder==0">No Filter</span>
                                      <span *ngIf="reminder>0">{{ reminder }} Day</span>

                                    </mat-option>
                                  </mat-select>
                                  <mat-error
                                    *ngIf="studentFilterForm.get('lastReminderDays')?.hasError('required') && studentFilterForm.get('lastReminderDays')?.touched">
                                    Gap since last reminder is required
                                  </mat-error>
                                  <mat-error
                                    *ngIf="studentFilterForm.get('lastReminderDays')?.hasError('pattern') && studentFilterForm.get('lastReminderDays')?.touched">
                                    Please enter a valid gap since last reminder (numeric characters only)
                                  </mat-error>
                                </mat-form-field>
                              </div>
                            </div>
                          </div>
                        </div>

                        <div class="modal-footer">
                          <button class="submit-button" mat-raised-button type="submit"
                            [disabled]="!studentFilterForm.valid">
                            <mat-icon>filter_list</mat-icon>
                            Choose Filters
                          </button>
                        </div>
                      </form>
                    </ng-container>

                    <ng-container *ngIf="filterStatus">
                      <div class="modal-body">
                        <div class="container">
                          <div class="row">
                            <div class="col-12">
                              <div class="table-wrapper" style="max-height: 380px; overflow-y: auto;">
                                <table class="table table-hover align-middle bg-white">
                                  <thead class="bg-light">
                                    <tr class="text-muted">
                                      <th>
                                        <mat-checkbox [checked]="isAllSelected"
                                          (change)="toggleAllSelection($event.checked)">
                                        </mat-checkbox>
                                      </th>
                                      <th>S.No.</th>
                                      <th>Mobile</th>
                                      <th>Student Name</th>
                                      <th>Father Name</th>
                                      <th>Mother Name</th>
                                      <th>Due Amount</th>
                                      <th>Paid Fee</th>
                                      <th>DOB</th>
                                      <th>Admission No.</th>
                                    </tr>
                                  </thead>

                                  <tbody *ngIf="studentFilterData && studentFilterData.length > 0">
                                    <tr *ngFor="let s of studentFilterData; let i = index">
                                      <td>
                                        <mat-checkbox [checked]="selectedIds.includes(s.studentId)"
                                          (change)="toggleSelection(s.studentId, $event.checked)"></mat-checkbox>
                                      </td>
                                      <td>{{ i + 1 }}</td>
                                      <td>{{ s.parentsContact }}</td>
                                      <td>{{ s.name | titlecase }}</td>
                                      <td>{{ s.fatherName | titlecase }}</td>
                                      <td>{{ s.motherName | titlecase }}</td>
                                      <td>&#8377; {{ s.pendingAmount}}</td>
                                      <td>&#8377; {{ s.paidAmount}}</td>
                                      <td>{{ s.dob }}</td>
                                      <td>{{ s.admissionNo }}</td>
                                    </tr>
                                  </tbody>

                                  <tbody *ngIf="studentFilterData.length === 0">
                                    <tr>
                                      <td colspan="10" class="text-center text-muted">No students found.</td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="modal-footer">
                        <button class="submit-button" mat-raised-button type="button" (click)="feeReminderLaterSend()">
                          <mat-icon>timer</mat-icon>
                          Send Later
                        </button>

                        <button class="submit-success-button" mat-raised-button type="button"
                          [disabled]="!selectedIds.length" (click)="feeReminderSend()" style="margin-left: 20px;">
                          <mat-icon>send</mat-icon>
                          Send Now
                        </button>
                      </div>
                    </ng-container>
                  </div>
                </div>
              </div>



            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>